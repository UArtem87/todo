let t="https://696f53afa06046ce618642cd.mockapi.io/tasks",e="https://696f53afa06046ce618642cd.mockapi.io/purchases";window.addEventListener("DOMContentLoaded",()=>{let a=[],s=null,n=e,o=document.querySelector(".header"),c=document.querySelector(".container"),i=document.querySelector(".title"),r=document.querySelector(".loader"),l=document.querySelector(".data__input"),d=document.querySelector(".data__btn"),u=document.querySelector(".items");async function m(e){i.textContent=e===t?"Надо сделать:":"Надо купить:",r.classList.remove("not-view");try{let t=await fetch(e);if(!t.ok)throw Error("Ошибка сервера");let s=await t.json();s&&(a=[],s.forEach(t=>{t.important?a.unshift(t):a.push(t)})),u.innerHTML="",a.forEach((t,e)=>{let a=`${t.text.slice(0,1).toUpperCase()}${t.text.slice(1)}`,s=document.createElement("div");s.setAttribute("id",t.id),s.classList.add("items__block");let n=document.createElement("span");n.classList.add("items__block--title"),n.textContent=`${e+1}. ${a}`;let o=document.createElement("span");o.classList.add("important"),o.innerHTML=t.important?"★":"☆",t.important&&o.classList.add("active");let c=document.createElement("span");c.classList.add("del");let i=document.createElement("span");i.classList.add("change"),i.innerHTML="&#9999",s.append(i,n,o,c),u.append(s)}),l.value="",u.classList.remove("faded")}catch(t){console.error("Не удалось загрузить список")}finally{r.classList.add("not-view")}}async function f(t){try{if(null!==s){if(""===l.value.trim())return void l.focus();await L(n,s,l.value),d.textContent="Сохранить",s=null}else if(""===l.value)l.focus();else{let e=l.value;if(!(await fetch(t,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({text:e})})).ok)throw Error("'Не удалось отправить данные на сервер'");await m(t)}}catch(t){console.error("Не удалось отправить данные на сервер")}}async function h(t,e){try{if(!(await fetch(`${t}/${e}`,{method:"DELETE"})).ok)throw Error("Не удалось удалить задачу");await m(t)}catch(t){console.error("Ошибка при удалении:",t),alert("Произошла ошибка при удалении задачи. Проверьте соединение.")}}async function p(t,e,a){try{if(!(await fetch(`${t}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({important:a})})).ok)throw Error("Не удалось обновить статус");await m(t)}catch(t){console.error("Ошибка изменения важности:",t)}}async function L(t,e,a){try{if(!(await fetch(`${t}/${e}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify({text:a})})).ok)throw Error("Не удалось изменить текст");await m(t)}catch(t){console.error("Ошибка при редактировании:",t),alert("Не удалось сохранить изменения.")}}document.addEventListener("click",t=>{let e=t.target,o=e.closest(".items__block");if(!o)return;let c=o.getAttribute("id");if(e.classList.contains("del")&&(o.classList.add("delete"),h(n,c)),e.classList.contains("important")){e.classList.toggle("active");let t=e.classList.contains("active");e.innerHTML=t?"★":"☆",p(n,c,t)}e.classList.contains("items__block--title")&&e.classList.toggle("expanded"),e.classList.contains("change")&&(s=c,l.value=a.find(t=>t.id===s).text,d.textContent="Обновить",l.focus())}),d.onclick=()=>f(n),l.onkeydown=t=>{"Enter"===t.key&&f(n)},o.addEventListener("click",a=>{s=null,d.textContent="Сохранить",l.value="";let o=a.target.classList.contains("tasks"),i=a.target.classList.contains("purchases");(o||i)&&(document.querySelectorAll(".view").forEach(t=>{t.classList.remove("active")}),a.target.classList.add("active"),document.querySelector(".main-title").classList.add("hidden"),c.classList.remove("hidden"),u.classList.add("faded"),setTimeout(()=>{m(n=o?t:e)},300))})});
//# sourceMappingURL=todo+.03942c30.js.map
